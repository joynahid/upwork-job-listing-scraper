FROM golang:1.21

WORKDIR /app/goapi

# Copy Go module manifests first for caching
COPY goapi/go.mod goapi/go.sum ./

# Download dependencies
RUN go mod download

# Copy the rest of the Go API source
COPY goapi/. ./

# Build the binary
RUN go build -o /app/api main.go

WORKDIR /app

# Create directory expected for mounting config files
RUN mkdir -p /app/config

# Expose port
EXPOSE 8080

# Run the application
CMD ["./api"]
