services:
  upwork-job-listing-scraper:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: upwork-job-listing-scraper
    volumes:
      # Mount storage directory for persistent data
      - ./storage:/app/storage
      # Mount logs directory
      - ./logs:/app/logs
      # Mount SQLite data directory for persistent job tracking
      - sqlite_data:/app/sqlite_data
      # Optional: mount source code for development (uncomment for dev mode)
      # - ./src:/app/src
    ports:
      # Expose port for potential web interface or debugging
      - "8080:8080"
    restart: unless-stopped
    # Resource limits
    mem_limit: 2g
    memswap_limit: 2g
    # Security options
    security_opt:
      - no-new-privileges:true
    # Health check
    healthcheck:
      test: ["CMD-SHELL", "python3 -c 'import sys; sys.exit(0)'"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    # Running as root user (no permission issues)
    environment:
      # Application configuration
      - LOCAL_STORAGE_DIR=/app/storage
      - LOG_LEVEL=${LOG_LEVEL:-INFO}

      # Proxy configuration (new environment variables)
      - PROXY_URL=${PROXY_URL:-}

      # Database configuration
      - ROCKSDB_DATA_DIR=/app/sqlite_data

# Volumes for persistent data
volumes:
  sqlite_data:
    driver: local

networks:
  default:
    name: upwork-job-listing-scraper-network
